<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Appointment Management System</title>
    <style>
        /* ============================================
           MEDIBOT CHATBOT WIDGET - PURE JS VERSION
           ============================================ */

        /* Base Styles & Font */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f9fafb;
            /* A light grey background for the demo page */
        }

        .medibot-widget * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Floating Action Button (FAB) */
        .medibot-fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
        }

        .medibot-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .medibot-fab svg {
            width: 28px;
            height: 28px;
            fill: white;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            position: absolute;
        }

        .medibot-fab .medibot-fab-icon-close {
            opacity: 0;
            transform: rotate(-90deg);
        }

        .medibot-fab.active .medibot-fab-icon-open {
            opacity: 0;
            transform: rotate(90deg);
        }

        .medibot-fab.active .medibot-fab-icon-close {
            opacity: 1;
            transform: rotate(0deg);
        }

        /* Chat Window */
        .medibot-window {
            position: fixed;
            bottom: 90px;
            right: 24px;
            width: 400px;
            max-width: calc(100vw - 32px);
            height: 600px;
            max-height: calc(100vh - 120px);
            background: white;
            border-radius: 16px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.25);
            display: flex;
            flex-direction: column;
            z-index: 9999;
            opacity: 0;
            transform: scale(0.9) translateY(20px);
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .medibot-window.active {
            opacity: 1;
            transform: scale(1) translateY(0);
            pointer-events: all;
        }

        /* Header */
        .medibot-header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .medibot-header-avatar {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .medibot-header-info h3 {
            color: white;
            font-size: 16px;
            font-weight: 600;
        }

        .medibot-header-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #ddd6fe;
        }

        .medibot-status-dot {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: medibot-pulse 2s infinite;
        }

        @keyframes medibot-pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        /* Messages Area */
        .medibot-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f3f4f6;
        }

        .medibot-message {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
            align-items: flex-end;
            animation: medibot-fadeIn 0.4s ease-out;
        }

        @keyframes medibot-fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .medibot-message.user {
            flex-direction: row-reverse;
        }

        .medibot-message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .medibot-message.bot .medibot-message-avatar {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
        }

        .medibot-message.user .medibot-message-avatar {
            background: #e5e7eb;
            color: #4b5563;
        }

        .medibot-message-bubble {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .medibot-message.bot .medibot-message-bubble {
            background: white;
            color: #374151;
            border-bottom-left-radius: 4px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .medibot-message.user .medibot-message-bubble {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border-bottom-right-radius: 4px;
        }

        /* Typing Indicator */
        .medibot-typing-bubble {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            height: 100%;
        }

        .medibot-typing-dot {
            width: 8px;
            height: 8px;
            background: #9ca3af;
            border-radius: 50%;
            animation: medibot-typing 1.4s infinite ease-in-out;
        }

        .medibot-typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .medibot-typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes medibot-typing {

            0%,
            60%,
            100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-6px);
            }
        }

        /* Warning Banner */
        .medibot-warning {
            background: #fef3c7;
            padding: 12px 16px;
            font-size: 11px;
            color: #92400e;
            display: flex;
            gap: 8px;
            align-items: flex-start;
            border-top: 1px solid #fde68a;
            flex-shrink: 0;
        }

        .medibot-warning svg {
            width: 14px;
            height: 14px;
            fill: #f59e0b;
            flex-shrink: 0;
            margin-top: 1px;
        }

        /* Input Area */
        .medibot-input-area {
            padding: 16px;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .medibot-input {
            flex: 1;
            padding: 10px 16px;
            border: 1px solid #d1d5db;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .medibot-input:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
        }

        .medibot-send-btn {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, opacity 0.2s;
            flex-shrink: 0;
        }

        .medibot-send-btn:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .medibot-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .medibot-send-btn svg {
            width: 18px;
            height: 18px;
            fill: white;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .medibot-window {
                width: 100%;
                max-width: 100%;
                height: 100%;
                max-height: 100%;
                right: 0;
                bottom: 0;
                border-radius: 0;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-light: #f8fafc;
            --text-dark: #1e293b;
            --text-medium: #64748b;
            --border: #e2e8f0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: white;
            padding: 50px 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 100%;
            text-align: center;
        }

        .login-card h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 2.2em;
        }

        .login-card p {
            color: var(--text-medium);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: var(--text-medium);
            color: white;
        }

        .btn-success {
            background: var(--secondary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Dashboard */
        .dashboard {
            display: none;
            min-height: 100vh;
            padding: 20px;
            background: var(--bg-light);
        }

        .dashboard.active {
            display: block;
        }

        .dashboard-header {
            background: white;
            padding: 25px 30px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .dashboard-header h1 {
            color: var(--primary);
            font-size: 2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 25px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 10px;
        }

        /* Stats Card */
        .stats-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .stats-card h2 {
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1600px;
        }

        th {
            background: var(--primary);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 15px 12px;
            border-bottom: 1px solid var(--border);
        }

        tbody tr:hover {
            background: var(--bg-light);
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            display: inline-block;
        }

        .status-scheduled {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-waiting {
            background: #fef3c7;
            color: #92400e;
        }

        .status-checked {
            background: #ddd6fe;
            color: #5b21b6;
        }

        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .action-btn {
            padding: 6px 12px;
            font-size: 0.85em;
            margin: 2px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 25px;
            border-bottom: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            border: none;
            padding: 0;
        }

        .modal-body {
            padding: 25px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: var(--text-medium);
            transition: color 0.2s;
        }

        .close-btn:hover {
            color: var(--danger);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: normal;
            cursor: pointer;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                text-align: center;
            }

            .header-actions {
                width: 100%;
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <div class="medibot-widget">
        <!-- Floating Button -->
        <button class="medibot-fab" id="medibot-fab" aria-label="Toggle chat">
            <svg class="medibot-fab-icon-open" viewBox="0 0 24 24">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z" />
            </svg>
            <svg class="medibot-fab-icon-close" viewBox="0 0 24 24">
                <path
                    d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
            </svg>
        </button>

        <!-- Chat Window -->
        <div class="medibot-window" id="medibot-window">
            <!-- Header -->
            <div class="medibot-header">
                <div class="medibot-header-avatar">ü©∫</div>
                <div class="medibot-header-info">
                    <h3>MediBot Assistant</h3>
                    <div class="medibot-header-status">
                        <span class="medibot-status-dot"></span>
                        <span>Online</span>
                    </div>
                </div>
            </div>

            <!-- Messages -->
            <div class="medibot-messages" id="medibot-messages">
                <!-- Initial bot message is now added dynamically via JS -->
            </div>

            <!-- Warning -->
            <div class="medibot-warning">
                <svg viewBox="0 0 24 24">
                    <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" />
                </svg>
                <div><strong>Disclaimer:</strong> This AI provides informational guidance only. Always consult a
                    certified doctor for diagnosis.</div>
            </div>

            <!-- Input -->
            <form class="medibot-input-area" id="medibot-form">
                <input type="text" class="medibot-input" id="medibot-input" placeholder="Type your medical question..."
                    autocomplete="off" />
                <button type="submit" class="medibot-send-btn" id="medibot-send">
                    <svg viewBox="0 0 24 24">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                    </svg>
                </button>
            </form>
        </div>
    </div>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <h1>ü©∫ Doctor Login</h1>
            <p>Welcome to Appointment Management System</p>
            <form id="loginForm" onsubmit="app.login(event)">
                <div class="form-group">
                    <label>üë®‚Äç‚öïÔ∏è Select Doctor</label>
                    <select id="doctorSelect" required>
                        <option value="">Choose your name</option>
                        <option value="Dr. Patel">Dr. Patel</option>
                        <option value="Dr. Kumar">Dr. Kumar</option>
                        <option value="Dr. Sharma">Dr. Sharma</option>
                        <option value="Dr. Singh">Dr. Singh</option>
                        <option value="Dr. Reddy">Dr. Reddy</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>üîê Doctor ID</label>
                    <input type="text" id="doctorId" required placeholder="Enter your Doctor ID">
                </div>
                <button type="submit" class="btn btn-primary">Login to Dashboard</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <!-- Header -->
        <div class="dashboard-header">
            <div>
                <h1>ü©∫ Appointment Management Dashboard</h1>
                <p style="color: var(--text-medium); margin-top: 5px;">Manage your appointments and patient
                    consultations</p>
            </div>
            <div class="user-info">
                <div class="user-badge" id="currentDoctor"></div>
                <button class="btn btn-danger" onclick="app.logout()">Logout</button>
            </div>
        </div>

        <div class="header-actions" style="margin-bottom: 25px; padding: 0 5px;">
            <button class="btn btn-primary" onclick="app.openAppointmentModal()">‚ûï New Appointment</button>
            <button class="btn btn-secondary" onclick="app.exportData()">üì• Export Data</button>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Sidebar -->
            <aside>
                <!-- Statistics -->
                <div class="card stats-card">
                    <h2>üìä My Statistics</h2>
                    <div class="stat-item">
                        <span>Total Appointments:</span>
                        <span class="stat-value" id="totalAppts">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Scheduled:</span>
                        <span class="stat-value" id="scheduledAppts">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Waiting:</span>
                        <span class="stat-value" id="waitingAppts">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Checked:</span>
                        <span class="stat-value" id="checkedAppts">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Completed:</span>
                        <span class="stat-value" id="completedAppts">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Cancelled:</span>
                        <span class="stat-value" id="cancelledAppts">0</span>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h2>‚ö° Quick Actions</h2>
                    <button class="btn btn-success" style="width: 100%; margin-bottom: 10px;"
                        onclick="app.filterByStatus('Waiting')">View Waiting Patients</button>
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;"
                        onclick="app.filterByToday()">Today's Appointments</button>
                    <button class="btn btn-secondary" style="width: 100%;" onclick="app.clearFilters()">Clear
                        Filters</button>
                </div>
            </aside>

            <!-- Main Content -->
            <main>
                <div class="card">
                    <h2>üóÇ My Appointments</h2>

                    <!-- Table View -->
                    <div id="tableView" class="view-content active">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>üìÜ Date</th>
                                        <th>üßæ Patient ID</th>
                                        <th>üìã Visit Type</th>
                                        <th>‚öß Gender</th>
                                        <th>üìû Contact</th>
                                        <th>üè† Address</th>
                                        <th>üíª Mode</th>
                                        <th>üí¨ Chief Complaint</th>
                                        <th>üìÖ Status</th>
                                        <th>üßæ Diagnosis</th>
                                        <th>üíä Medicines</th>
                                        <th>üìÜ Next Visit</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="appointmentsTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Appointment Modal -->
    <div id="appointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï New Appointment</h2>
                <button class="close-btn" onclick="app.closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="appointmentForm" onsubmit="app.saveAppointment(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>üìÜ Date *</label>
                            <input type="date" id="date" required>
                        </div>
                        <div class="form-group">
                            <label>üßæ Patient ID *</label>
                            <input type="text" id="patientId" required placeholder="P-1024">
                        </div>
                        <div class="form-group">
                            <label>üìã Visit Type *</label>
                            <div class="radio-group">
                                <label><input type="radio" name="visitType" value="New" required> New</label>
                                <label><input type="radio" name="visitType" value="Follow-up"> Follow-up</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>‚öß Gender *</label>
                            <div class="radio-group">
                                <label><input type="radio" name="gender" value="Male" required> Male</label>
                                <label><input type="radio" name="gender" value="Female"> Female</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>üìû Contact *</label>
                            <input type="tel" id="contact" required placeholder="9876543210" pattern="[0-9]{10}">
                        </div>
                        <div class="form-group">
                            <label>üè† Address *</label>
                            <input type="text" id="address" required placeholder="Mumbai">
                        </div>
                        <div class="form-group">
                            <label>üíª Mode *</label>
                            <div class="radio-group">
                                <label><input type="radio" name="mode" value="Direct" required> Direct</label>
                                <label><input type="radio" name="mode" value="Online"> Online</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>üìÖ Status *</label>
                            <select id="status" required>
                                <option value="Scheduled">Scheduled</option>
                                <option value="Waiting">Waiting</option>
                                <option value="Checked">Checked</option>
                                <option value="Completed">Completed</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label>üí¨ Chief Complaint *</label>
                            <textarea id="complaint" required placeholder="Fever, headache, etc."></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label>üßæ Diagnosis</label>
                            <textarea id="diagnosis" placeholder="Enter diagnosis after consultation"></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label>üíä Prescribed Medicines</label>
                            <textarea id="medicines" placeholder="Enter prescribed medicines"></textarea>
                        </div>
                        <div class="form-group">
                            <label>üìÜ Next Visit</label>
                            <input type="date" id="nextVisit">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                        Save Appointment
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const app = {
            currentDoctor: null,
            appointments: [],
            editingId: null,
            filterStatus: null,
            filterToday: false,

            init() {
                this.loadData();
                this.checkLogin();
            },

            checkLogin() {
                const loggedIn = sessionStorage.getItem('loggedInDoctor');
                if (loggedIn) {
                    this.currentDoctor = loggedIn;
                    this.showDashboard();
                } else {
                    document.getElementById('loginScreen').style.display = 'flex';
                }
            },

            login(e) {
                e.preventDefault();
                const doctor = document.getElementById('doctorSelect').value;
                const doctorId = document.getElementById('doctorId').value;

                if (doctor && doctorId) {
                    this.currentDoctor = doctor;
                    sessionStorage.setItem('loggedInDoctor', doctor);
                    sessionStorage.setItem('doctorId', doctorId);
                    this.showDashboard();
                }
            },

            logout() {
                if (confirm('Are you sure you want to logout?')) {
                    sessionStorage.removeItem('loggedInDoctor');
                    sessionStorage.removeItem('doctorId');
                    this.currentDoctor = null;
                    document.getElementById('loginScreen').style.display = 'flex';
                    document.getElementById('dashboard').classList.remove('active');
                    document.getElementById('loginForm').reset();
                }
            },

            showDashboard() {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('dashboard').classList.add('active');
                document.getElementById('currentDoctor').textContent = this.currentDoctor;
                document.getElementById('date').value = new Date().toISOString().split('T')[0];
                this.renderAppointments();
                this.updateStats();
            },

            loadData() {
                const stored = sessionStorage.getItem('appointments');
                if (stored) {
                    this.appointments = JSON.parse(stored);
                }
            },

            saveData() {
                sessionStorage.setItem('appointments', JSON.stringify(this.appointments));
            },

            getMyAppointments() {
                let filtered = this.appointments.filter(a => a.doctor === this.currentDoctor);

                if (this.filterStatus) {
                    filtered = filtered.filter(a => a.status === this.filterStatus);
                }

                if (this.filterToday) {
                    const today = new Date().toISOString().split('T')[0];
                    filtered = filtered.filter(a => a.date === today);
                }

                return filtered;
            },

            openAppointmentModal() {
                this.editingId = null;
                document.getElementById('appointmentModal').classList.add('active');
            },

            closeModal() {
                document.getElementById('appointmentModal').classList.remove('active');
                document.getElementById('appointmentForm').reset();
                this.editingId = null;
            },

            saveAppointment(e) {
                e.preventDefault();

                const appointment = {
                    id: this.editingId || Date.now().toString(),
                    doctor: this.currentDoctor,
                    date: document.getElementById('date').value,
                    patientId: document.getElementById('patientId').value,
                    visitType: document.querySelector('input[name="visitType"]:checked').value,
                    gender: document.querySelector('input[name="gender"]:checked').value,
                    mode: document.querySelector('input[name="mode"]:checked').value,
                    contact: document.getElementById('contact').value,
                    address: document.getElementById('address').value,
                    complaint: document.getElementById('complaint').value,
                    status: document.getElementById('status').value,
                    diagnosis: document.getElementById('diagnosis').value,
                    medicines: document.getElementById('medicines').value,
                    nextVisit: document.getElementById('nextVisit').value
                };

                if (this.editingId) {
                    const index = this.appointments.findIndex(a => a.id === this.editingId);
                    this.appointments[index] = appointment;
                } else {
                    this.appointments.push(appointment);
                }

                this.saveData();
                this.closeModal();
                this.renderAppointments();
                this.updateStats();
                alert('‚úÖ Appointment saved successfully!');
            },

            deleteAppointment(id) {
                if (confirm('Delete this appointment?')) {
                    this.appointments = this.appointments.filter(a => a.id !== id);
                    this.saveData();
                    this.renderAppointments();
                    this.updateStats();
                }
            },

            editAppointment(id) {
                const apt = this.appointments.find(a => a.id === id);
                if (!apt) return;

                this.editingId = id;
                document.getElementById('date').value = apt.date;
                document.getElementById('patientId').value = apt.patientId;
                document.querySelector(`input[name="visitType"][value="${apt.visitType}"]`).checked = true;
                document.querySelector(`input[name="gender"][value="${apt.gender}"]`).checked = true;
                document.querySelector(`input[name="mode"][value="${apt.mode}"]`).checked = true;
                document.getElementById('contact').value = apt.contact;
                document.getElementById('address').value = apt.address;
                document.getElementById('complaint').value = apt.complaint;
                document.getElementById('status').value = apt.status;
                document.getElementById('diagnosis').value = apt.diagnosis || '';
                document.getElementById('medicines').value = apt.medicines || '';
                document.getElementById('nextVisit').value = apt.nextVisit || '';

                this.openAppointmentModal();
            },

            renderAppointments() {
                const tbody = document.getElementById('appointmentsTable');
                const myAppts = this.getMyAppointments().sort((a, b) => new Date(b.date) - new Date(a.date));

                tbody.innerHTML = myAppts.map(apt => `
                    <tr>
                        <td>${apt.date}</td>
                        <td>${apt.patientId}</td>
                        <td>${apt.visitType}</td>
                        <td>${apt.gender}</td>
                        <td>${apt.contact}</td>
                        <td>${apt.address}</td>
                        <td>${apt.mode}</td>
                        <td>${apt.complaint}</td>
                        <td><span class="status-badge status-${apt.status.toLowerCase()}">${apt.status}</span></td>
                        <td>${apt.diagnosis || '-'}</td>
                        <td>${apt.medicines || '-'}</td>
                        <td>${apt.nextVisit || '-'}</td>
                        <td>
                            <button class="action-btn btn-primary" onclick="app.editAppointment('${apt.id}')">Edit</button>
                            <button class="action-btn btn-danger" onclick="app.deleteAppointment('${apt.id}')">Delete</button>
                        </td>
                    </tr>
                `).join('');

                if (myAppts.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="13" style="text-align: center; padding: 40px;">No appointments found</td></tr>';
                }
            },

            updateStats() {
                const myAppts = this.appointments.filter(a => a.doctor === this.currentDoctor);
                const totalAppts = myAppts.length;
                const scheduledAppts = myAppts.filter(a => a.status === 'Scheduled').length;
                const waitingAppts = myAppts.filter(a => a.status === 'Waiting').length;
                const checkedAppts = myAppts.filter(a => a.status === 'Checked').length;
                const completedAppts = myAppts.filter(a => a.status === 'Completed').length;
                const cancelledAppts = myAppts.filter(a => a.status === 'Cancelled').length;

                document.getElementById('totalAppts').textContent = totalAppts;
                document.getElementById('scheduledAppts').textContent = scheduledAppts;
                document.getElementById('waitingAppts').textContent = waitingAppts;
                document.getElementById('checkedAppts').textContent = checkedAppts;
                document.getElementById('completedAppts').textContent = completedAppts;
                document.getElementById('cancelledAppts').textContent = cancelledAppts;
            },

            filterByStatus(status) {
                this.filterStatus = status;
                this.filterToday = false;
                this.renderAppointments();
            },

            filterByToday() {
                this.filterToday = true;
                this.filterStatus = null;
                this.renderAppointments();
            },

            clearFilters() {
                this.filterStatus = null;
                this.filterToday = false;
                this.renderAppointments();
            },

            exportData() {
                const myAppts = this.getMyAppointments();
                const data = JSON.stringify(myAppts, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${this.currentDoctor}-appointments-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                alert('‚úÖ Data exported successfully!');
            }
        };

        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
    <script type="module">
        import { GoogleGenAI } from "https://aistudiocdn.com/@google/genai@^1.28.0";

        // --- CONFIGURATION ---

        // PASTE YOUR GEMINI API KEY HERE
        const API_KEY = "AIzaSyCe_3sX0PA4dRh0r7s7UzWD-ys0YePULH4";

        const SYSTEM_PROMPT = `You are MediBot, an AI medical assistant in a hospital system. 
    
            STRICT RULES:
            1. ONLY respond to medical/healthcare queries:
               - Symptoms, diseases, conditions
               - Treatments, medications, procedures
               - Appointments, hospital services
               - Doctor specializations, departments
               - Medical tests, diagnostics
               - Health and wellness advice
    
            2. For NON-MEDICAL queries, respond: "I'm MediBot, a medical assistant. I can only help with health-related questions. Please ask about symptoms, treatments, appointments, or hospital services."
    
            3. Always add the disclaimer: "This is general information. Please consult a healthcare professional for personalized medical advice." at the end of every medical response.
    
            4. For urgent symptoms (e.g., chest pain, severe bleeding, difficulty breathing, sudden weakness), immediately say: "This sounds urgent. Please seek immediate medical attention or call emergency services." and stop the conversation.
    
            5. Be empathetic, clear, and use simple language. Avoid overly technical jargon.
    
            6. Keep responses concise and helpful. Use formatting like bullet points (e.g., "* item") to improve readability.`;

        const INITIAL_GREETING = `Hello! I'm MediBot, your AI medical assistant. I can help you with:<br><br>
                            &bull; Symptom analysis<br>
                            &bull; Treatment information<br>
                            &bull; Appointment guidance<br>
                            &bull; Hospital services<br><br>
                            How can I assist you today?`;

        // --- DOM ELEMENTS ---
        const fab = document.getElementById('medibot-fab');
        const windowEl = document.getElementById('medibot-window');
        const messagesEl = document.getElementById('medibot-messages');
        const formEl = document.getElementById('medibot-form');
        const inputEl = document.getElementById('medibot-input');
        const sendBtn = document.getElementById('medibot-send');

        // --- STATE ---
        let isOpen = false;
        let isLoading = false;
        let isInitialized = false;
        let chat = null;

        // --- UI FUNCTIONS ---
        function toggleChat() {
            isOpen = !isOpen;
            windowEl.classList.toggle('active');
            fab.classList.toggle('active');
            if (isOpen) {
                inputEl.focus();
            }
        }

        function scrollToBottom() {
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatMessageText(text) {
            let safeText = escapeHtml(text);
            // Bold: **text** -> <strong>text</strong>
            safeText = safeText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            // Unordered lists: * item or - item -> &bull; item
            safeText = safeText.replace(/^\s*[\*-]\s+(.*)/gm, '&bull; $1');
            // Newlines -> <br>
            safeText = safeText.replace(/\n/g, '<br />');
            // Clean up extra breaks that might be created by the list conversion
            safeText = safeText.replace(/<br \/>&bull;/g, '&bull;');
            return safeText;
        }

        function addMessage(text, role, isFormatted = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `medibot-message ${role}`;

            const avatar = role === 'bot' ? 'ü©∫' : 'üë§';
            const messageContent = isFormatted ? text : formatMessageText(text);

            messageDiv.innerHTML = `
                    <div class="medibot-message-avatar">${avatar}</div>
                    <div class="medibot-message-bubble">${messageContent}</div>`;

            messagesEl.appendChild(messageDiv);
            scrollToBottom();
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'medibot-typing-indicator';
            typingDiv.className = 'medibot-message bot';
            typingDiv.innerHTML = `
                    <div class="medibot-message-avatar">ü©∫</div>
                    <div class="medibot-message-bubble">
                        <div class="medibot-typing-bubble">
                            <span class="medibot-typing-dot"></span>
                            <span class="medibot-typing-dot"></span>
                            <span class="medibot-typing-dot"></span>
                        </div>
                    </div>`;
            messagesEl.appendChild(typingDiv);
            scrollToBottom();
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('medibot-typing-indicator');
            if (indicator) indicator.remove();
        }

        function setLoadingState(loading) {
            isLoading = loading;
            inputEl.disabled = loading;
            sendBtn.disabled = loading;
            inputEl.placeholder = loading ? "MediBot is thinking..." : "Type your medical question...";
        }

        // --- API & INITIALIZATION ---
        async function initializeApp() {
            if (!API_KEY || API_KEY === "YOUR_API_KEY_HERE") {
                console.error("MediBot Error: API_KEY is not set.");
                addMessage("‚ö†Ô∏è I'm currently unavailable due to a configuration issue. Please add a valid API key.", 'bot');
                setLoadingState(true);
                inputEl.placeholder = "Chat unavailable";
                return;
            }

            try {
                const ai = new GoogleGenAI({ apiKey: API_KEY });
                chat = ai.chats.create({
                    model: 'gemini-2.5-flash',
                    config: { systemInstruction: SYSTEM_PROMPT, temperature: 0.7 }
                });
                isInitialized = true;
                console.log("MediBot is initialized and ready.");
                addMessage(INITIAL_GREETING, 'bot', true);
            } catch (error) {
                console.error("MediBot Initialization Error:", error);
                addMessage("‚ö†Ô∏è I'm having trouble starting up. Please check the API key and refresh the page.", 'bot');
                setLoadingState(true);
                inputEl.placeholder = "Initialization failed";
            }
        }

        async function getBotResponse(userMessage) {
            if (!isInitialized || !chat) {
                return "I'm not ready yet. Please wait a moment or refresh the page.";
            }
            try {
                const result = await chat.sendMessage({ message: userMessage });
                return result.text;
            } catch (error) {
                console.error('Gemini API Error:', error);
                return "I apologize, but I'm having trouble connecting. Please try again in a moment.";
            }
        }

        // --- EVENT HANDLERS ---
        async function handleFormSubmit(e) {
            e.preventDefault();
            const userText = inputEl.value.trim();
            if (!userText || isLoading || !isInitialized) return;

            addMessage(userText, 'user');
            inputEl.value = '';
            setLoadingState(true);
            showTypingIndicator();

            const botResponse = await getBotResponse(userText);

            removeTypingIndicator();
            addMessage(botResponse, 'bot');
            setLoadingState(false);
            inputEl.focus();
        }

        // --- STARTUP ---
        fab.addEventListener('click', toggleChat);
        formEl.addEventListener('submit', handleFormSubmit);
        initializeApp();

    </script>
</body>

</html>